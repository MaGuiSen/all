<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>锻炼大脑</title>
    <meta name='viewport' content='width=device-width, user-scalable=no, initial-scale=1.0'>
    <link href="../../image/laugh/icon_logo_ico.ico" rel="shortcut icon">
    <link rel='stylesheet' href='../../css/base/self_base.css'>
    <script src="../../js/bmob/bmob-min.js"></script>
    <script type="text/javascript" src="../../js/base/self_base.js"></script>
    <script type='text/javascript' src='../../js/base/jqeury.min.js'></script>
</head>
<body>
<bgsound id="sound" src="" loop=1>
<div id="mainLayout" style="position:fixed;top:0;left:0;right:0;bottom:0">
</div>
<!---下面将演示一种绘制矩形的demo--->
<script type="text/javascript">
    var $j = jQuery.noConflict();
    var mainLayout = $j("#mainLayout");
    var topPart = null;
    var centerPart = null;
    var bottomPart = null;
    var baseParams = {};
    var topPartConvas = null;
    var centerPartConvas = null;

    //获取圆形的宽带列表
    function getCircleWList(){
        var circleWList = [];
        for(var i=0;i<5;i++){
            circleWList[i] = baseParams.circleMinW + baseParams.circleWGrads * i;
        }
        return circleWList
    }

    //获取颜色列表
    function getCircleColorList(){
        return [
            "red",
            "yellow",
            "blue",
            "black",
            "green",
        ];
    }

    function init() {
        baseParams.sh = mainLayout.height();
        baseParams.sw = mainLayout.width();
        baseParams.circleH = 25;
        //最小的circle宽度
        baseParams.circleMinW = 20;
        //最大的circle宽度
        baseParams.circleMaxW = baseParams.sw/2 - 20;
        baseParams.circleMaxNum = 5;//最多几个圆
        //每个圆形宽度的梯度
        baseParams.circleWGrads = (baseParams.circleMaxW - baseParams.circleMinW)/ baseParams.circleMaxNum;
        baseParams.circleWList = getCircleWList();
        baseParams.circleColorList = getCircleColorList();
        baseParams.topPartPadding = 50;
        baseParams.topPartH = baseParams.circleH * 5 + 2*baseParams.topPartPadding;
        baseParams.bottomPartH = 60;
        baseParams.centerPartH = baseParams.sh - baseParams.topPartH - baseParams.bottomPartH;
        //绘制
        var mainHtml = `
            <canvas id="topPart" width='${baseParams.sw}px' height='${baseParams.topPartH}px'/>
            <canvas id="centerPart" width='${baseParams.sw}px' height='${baseParams.centerPartH}px'/>
            <div id="bottomPart" style="width:${baseParams.sw}px;height:${baseParams.bottomPartH}px;"></div>
        `;
        mainLayout.html(mainHtml);
        topPart = $j("#topPart");
        centerPart = $j("#centerPart");
        bottomPart = $j("#bottomPart");
        centerPart.click(function (event) {
            var circleMainAll = baseParams.mainCircles;
            var circleOther1All = baseParams.circleOther1All;
            var circleOther2All = baseParams.circleOther2All;
            document.all.sound.src="../../sound/tock.mp3";
            if(checkInCircles(event.offsetX, event.offsetY, circleMainAll)){
               alert("main")
            }else if(checkInCircles(event.offsetX, event.offsetY, circleOther1All)){
                alert("other1")
            }else if(checkInCircles(event.offsetX, event.offsetY, circleOther2All)){
                alert("other2")
                resetCircles();
            }
        });
    }

    function checkInCircles(pointX, pointY, circleAll) {
        var xdiff = circleAll.centerX - pointX;
        var ydiff = circleAll.centerY - pointY;
        var distance = Math.pow((xdiff * xdiff + ydiff * ydiff), 0.5);
        for(var index in circleAll.circles){
            if(circleAll.circles[index].width/2 >= distance){
                return true;
            }
        }
        return false;
    }

    function getRandomRect() {
        var rectList = [];
        for(var i=0;i<5;i++){
            rectList[i] ={
              color:baseParams.circleColorList[GetRandomNum(0, 4)],
              width:baseParams.circleWList[GetRandomNum(0, 4)],
            };
        }
        return rectList;
    }

    function drawRect() {
        var canvas = topPart.get(0).getContext('2d');//注意当用jquery的时候这里需要加get(0)
        topPartConvas = canvas;
        canvas.shadowOffsetX = 1; // 阴影Y轴偏移
        canvas.shadowOffsetY = 1; // 阴影X轴偏移
        canvas.shadowBlur = 8; // 模糊尺寸
        canvas.shadowColor = 'rgba(0, 0, 0, 0.5)'; // 颜色
        var rectList = getRandomRect();
        baseParams.rectList = rectList;
        for(var i=0;i<rectList.length;i++){
            canvas.fillStyle = rectList[i].color;
            var x = baseParams.sw / 2 - rectList[i].width / 2;
            var y = baseParams.topPartH - baseParams.topPartPadding - i*baseParams.circleH;
            canvas.fillRect(x,y,rectList[i].width,baseParams.circleH);
        }
    }

    function drawCircle(circleAll){
        var x = circleAll.centerX;
        var y = circleAll.centerY;;
        var circles = circleAll.circles;
        var canvas = centerPart.get(0).getContext('2d');//注意当用jquery的时候这里需要加get(0)
        centerPartConvas = canvas;
        canvas.shadowOffsetX = 1; // 阴影Y轴偏移
        canvas.shadowOffsetY = 1; // 阴影X轴偏移
        canvas.shadowBlur = 8; // 模糊尺寸
        canvas.shadowColor = 'rgba(0, 0, 0, 0.5)'; // 颜色
        for(var index in circles){
            var circle = circles[index];
            canvas.fillStyle=circle.color;
            canvas.beginPath();
            canvas.arc(x ,y ,circle.width/2 ,0 ,Math.PI*2 ,true);
            canvas.closePath();
            canvas.fill();
        }
    }

    function drawCircles() {
        var centers = [{
            centerX:baseParams.sw/4,
            centerY:baseParams.centerPartH/4,
        }, {
            centerX:3*baseParams.sw/4,
            centerY:baseParams.centerPartH/4,
        }, {
            centerX:baseParams.sw/2,
            centerY:3*baseParams.centerPartH/4,
        }];
        centers.sort(function(){return Math.random()>0.5?-1:1;})//随机排序
        var circleMainAll = {
            centerX:centers[0].centerX,
            centerY:centers[0].centerY,
            circles:baseParams.rectList
        };
        var circleOther1All = {
            centerX:centers[1].centerX,
            centerY:centers[1].centerY,
            circles:getRandomRect()
        };
        var circleOther2All = {
            centerX:centers[2].centerX,
            centerY:centers[2].centerY,
            circles:getRandomRect()
        };
        baseParams.mainCircles = circleMainAll;
        baseParams.circleOther1All = circleOther1All;
        baseParams.circleOther2All = circleOther2All;
        var arr = [circleMainAll, circleOther1All, circleOther2All];
        for(var index in arr){
            drawCircle(arr[index]);
        }
    }

    function resetCircles() {
        //清除
        topPartConvas.clearRect(0, 0, topPartConvas.canvas.width, topPartConvas.canvas.height);
        centerPartConvas.clearRect(0, 0, centerPartConvas.canvas.width, centerPartConvas.canvas.height);
        drawRect();
        drawCircles();
    }

    setTimeout(function () {
        init();
        drawRect();
        drawCircles();
    }, 500)
</script>
</body>
</html>